<!DOCTYPE html>
<html>
<body>

<p>Click the button to start the test 2s:</p>

<button onclick="myFunction()">Go!</button>

<script>

function myFunction() {
  var lookupfile="./qrcodes.csv";
  
  var prodCode = getQueryString("Prod", window.location.href)
  alert(prodCode);
    
  var arr = readCSV(lookupfile);


 for (var i=0;i<arr.length;i++) {
      alert("test"); 	
     // arr[i] = parseLineCSV(arr[i]);
 }



};


 var getQueryString = function ( field, url ) {
    var href = url ? url : window.location.href;
    var reg = new RegExp( '[?&]' + field + '=([^&#]*)', 'i' );
    var string = reg.exec(href);
    return string ? string[1] : null;
};

function readCSV(locfile) {
// load a whole csv file, and then split it line by line
 var req = new XMLHttpRequest();
 req.open("POST",locfile,false);
 req.send("");
 return req.responseText.split(/\n/g);
};
 
function parseLineCSV(lineCSV) {
// parse csv line by line into array
 var CSV = new Array();
 
 lineCSV = lineCSV.replace(/,/g," ,");
 
 lineCSV = lineCSV.split(/,/g);
  for (var i=0;i
    <lineCSV.length;i++) {
 lineCSV[i] = lineCSV[i].replace(/\s*$/g,"");   
 };
 
 lineCSV[lineCSV.length-1]=lineCSV[lineCSV.length-1].replace(/^\s*|\s*$/g,"");
 var fstart = -1;
 
 for (var i=0;i<lineCSV.length;i++) {
 if (lineCSV[i].match(/"$/)) {
 if (fstart>=0) {
 for (var j=fstart+1;j<=i;j++) {
 lineCSV[fstart]=lineCSV[fstart]+","+lineCSV[j];
 lineCSV[j]="-DELETED-";
 }
 fstart=-1;
 }
 }
 fstart = (lineCSV[i].match(/^"/)) ? i : fstart;
 }
 
 var j=0;
 
 for (var i=0;i
    <lineCSV.length;i++) {
 if (lineCSV[i]!="-DELETED-") {
 CSV[j] = lineCSV[i];
 CSV[j] = CSV[j].replace(/^\s*|\s*$/g,"");     // remove leading & trailing space
 CSV[j] = CSV[j].replace(/^"|"$/g,"");         // remove " on the beginning and end
 CSV[j] = CSV[j].replace(/""/g,'"');           // replace "" with "
 j++;
 }
 }
 
 return CSV;
};


</script>

</body>
</html>
