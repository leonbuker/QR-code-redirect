<!DOCTYPE html>
<html>
<head>
<link rel="canonical" href="http://www.tolotoys.com/"/>
<noscript>
  <meta http-equiv="refresh" content="0;URL=http://www.tolotoys.com/">
</noscript>

<script type="text/javascript">
  window.onload = myFunction;

  function myFunction() {
    //  var lookupfile="./qrcodes.csv";
    var lookupfile = "file:///C:/temp/qrcodes.csv";
    var destinationURL="http://www.tolotoys.com/";

    var prodCode = getQueryString("Prod");
    if ( (prodCode.length == 5) && (IsNumeric(prodCode)) )
    { 
      // Product code passes basic test
      readCSV(lookupfile, function ()
      {
        var i=0;
        while (i<arrText.length)
        {
          if (arrText[i][0] == prodCode) 
          {
            destinationURL = arrText[i][1];
            i=arrText.length; //break out of the while loop
          }
          i++;
        }
        GoToURL(destinationURL); 
      });
    } else {
      GoToURL(destinationURL);
    };
  };

  function GoToURL(URL)
  {
   if(typeof IE_fix != "undefined") // IE8 and lower fix to pass the http referer
   {
      document.write("redirecting..."); // Don't remove this line or appendChild() will fail because it is called before document.onload to make the redirect as fast as possible. Nobody will see this text, it is only a tech fix.
      var referLink = document.createElement("a");
      referLink.href = URL;
      document.body.appendChild(referLink);
      referLink.click();
    } else { 
      window.location.replace(URL);
    } // All other browsers
  };

  var getQueryString = function ( field, url )
  {
    var href = url ? url : window.location.href;
    var reg = new RegExp( '[?&]' + field + '=([^&#]*)', 'i' );
    var string = reg.exec(href);
    return string ? string[1] : null;
  };

  function IsNumeric(input)
  {
    return (input - 0) == input && (''+input).trim().length > 0;
  }

  function readCSV(locfile, callback)
  {
    var rawFile = new XMLHttpRequest();
    rawFile.open("GET", locfile, true);
    rawFile.onreadystatechange = function ()
    {
      if(rawFile.readyState === 4)
      {
        if(rawFile.status === 200 || rawFile.status == 0)
        {
          arrText=CSVToArray(rawFile.responseText);
          callback(arrText);
        }
      }
    }
    rawFile.send(null);
  };
   

  // This will parse a delimited string into an array of
  // arrays. The default delimiter is the comma, but this
  // can be overriden in the second argument.
  function CSVToArray( strData, strDelimiter )
  {
    strDelimiter = (strDelimiter || ",");
    var objPattern = new RegExp((
              // Delimiters.
              "(\\" + strDelimiter + "|\\r?\\n|\\r|^)" +
              // Quoted fields.
              "(?:\"([^\"]*(?:\"\"[^\"]*)*)\"|" +
              // Standard fields.
              "([^\"\\" + strDelimiter + "\\r\\n]*))"),"gi");
    var arrData = [[]];
    var arrMatches = null;
    while (arrMatches = objPattern.exec( strData ))
    {
      var strMatchedDelimiter = arrMatches[ 1 ];
      if ( strMatchedDelimiter.length && strMatchedDelimiter !== strDelimiter)
      {arrData.push( [] );}
      var strMatchedValue;
      if (arrMatches[ 2 ])
      {
        strMatchedValue = arrMatches[ 2 ].replace(new RegExp( "\"\"", "g" ),"\"");
      } else {
        strMatchedValue = arrMatches[ 3 ];
      }
      arrData[ arrData.length - 1 ].push( strMatchedValue );
    }
    return( arrData );
  }
</script>
</head>
<body>
</body>
</html>